<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <h1>
            <p align="center">Form cancellazione - Vue JS</p>
        </h1>
        <hr>
        <div id="app">
            <h5 align="center">Stringa JSON</h5>
            
            {{ info.data }}

            <br>
            <h8>{{ "Numero items ->" + this.info.data.length }}</h8>
            <hr>
            <h5 align="center">Inserimento</h5>

            <form action="/api/v2/inseriscipersona" method="POST" >
                <label>Nome</label>
                <input type="text" name="nome">
                <label>Cognome</label>
                <input type="text" name="cognome">
                <label>Anno di nascita</label>     
                <input type="number" name="anno">        
                <input type="submit" name="Inserisci">
            </form>
            <br>
                <button @click="refreshpagina(1)" div align="center" text-align="center" style="font-size:1em">Refresh</button>

            <hr>
            <div v-if="min!=max">
                <h5 align="center">Cancellazione</h5>
                <p style="font-size:2em" >Record {{counter+1}}/{{this.info.data.length}}</p>
                <p style="font-size:2em" >{{info.data[counter].Cognome+" "+info.data[counter].Nome+" "+info.data[counter].Anno}}</p>

                <div class="row">

                    <div class="col-1">
                        <button :disabled='minDisabled' @click="changeCounter($event,'-')"
                            style="font-size:2em"><-</button>
                    </div>

                    <div class="col-1">
                        <button :disabled='maxDisabled' @click="changeCounter($event,'+')"
                            style="font-size:2em">-></button>
                    </div>

                </div>

<div class="col-6">
    <button  @click="eliminaPersona()"
        style="font-size:2em">Elimina</button>
</div>

            </div>
            <div v-else>
                Errore min max uguali
            </div>

        </div>

    </div>
    </div>
</body>
<script>
    var app = new Vue({
        el: '#app',

        data: {
            min: 0,
            max: 20,
            minDisabled: true,
            maxDisabled: false,
            counter: 0,

            info: null,

            insnome: null,
            inscognome:null,
            inseta:2000

        },

        mounted() {
            axios
                .get('/api/listapersonejson')
                .then(response => (this.info = response))
        },

        methods: {

            refreshpagina(_millisecondi)
            {
                window.location.reload();
            },
/*
            inserisciPersona()
            {
                
                console.log(this.info.data[this.counter].Cognome.length);
                
                window.alert(this.info.data[this.counter].Cognome.length);  

                if (this.info.data[this.counter].Cognome.length<1)
                {
                    window.alert("Il campo COGNOME non è stato dichiarato");   

                }

                if (this.info.data[this.counter].Nome.length<1)
                {
                    window.alert("Il campo NOME non è stato dichiarato");   

                }

                const persona = new personaModello({ Cognome: insnome, Nome: inscognome, Anno: inseta });

                window.alert(Cognome);
                console.log("PIPPO");

                persona.save(function (err) {
                if (err) return console.error(err);
                console.log("Inserimento effettuato");
                res.send("OK");
                });
                
            },
*/        
            eliminaPersona()
            {
//                window.alert(this.info.data[this.counter].Cognome.length);
                window.alert("Elimina persona "+ this.info.data[this.counter]._id + " " + this.info.data[this.counter].Cognome);

                
//                if (this.info.data[this.counter].Cognome.length==0)
//                    window.alert("Cognome non definito");

                axios
                .get('/api/v1/elimina/'+this.info.data[this.counter].Cognome)
                window.location.reload();
            },

            changeCounter(event, direction) {
                console.log("event :");
                console.log(event);
                console.log("changeCounter :" + direction);

                if (direction == '+') {
                    if (this.counter < this.max) {
                        this.counter++;
                    }
                } else if (direction == '-') {
                    if (this.counter > this.min) {
                        this.counter--;
                    }
                }

                if (this.counter >= this.max || (((this.counter + 1) >= this.info.data.length))) {

                    this.minDisabled = false;
                    this.maxDisabled = true;
                } else if (this.counter <= this.min) {
                    this.minDisabled = true;
                    this.maxDisabled = false;
                } else {
                    this.minDisabled = false;
                    this.maxDisabled = false;
                }
            },
        }
    })

</script>
</html>